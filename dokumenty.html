<!doctype html>
<html lang="pl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>ARKON ‚Äî Dokumenty</title>
<meta name="description" content="Wzory um√≥w i o≈õwiadcze≈Ñ. Wyszukiwarka, sortowanie, tagi, podglƒÖd PDF.">
<style>
  :root{
    --bg:#0c0c0c; --panel:#121212; --card:#181818; --line:#2a2a2a;
    --ink:#f2f3f5; --muted:#b9c0cc;
    --accent:#3ea6ff; --accent2:#00e5ff;
    --bad:#ff5c5c; --ok:#2ecc71;
  }
  *{box-sizing:border-box}
  html,body{margin:0;height:100%}
  body{background:var(--bg);color:var(--ink);font:15px/1.55 system-ui,Segoe UI,Roboto,Arial}
  a{color:var(--accent);text-decoration:none}
  a:hover{color:#fff}
  header{padding:16px;background:#0f0f0f;border-bottom:1px solid var(--line)}
  header h1{margin:0;font-size:22px}
  .small{font-size:12px;color:var(--muted)}
  nav{background:#141414;display:flex;gap:10px;flex-wrap:wrap;padding:10px 16px;border-bottom:1px solid var(--line);position:sticky;top:0;z-index:10}
  nav a,nav button{
    color:var(--ink);background:#1b1b1b;border:1px solid var(--line);padding:8px 12px;border-radius:8px;cursor:pointer
  }
  nav a[aria-current="page"],nav button.active{background:#202020;border-color:#3b3b3b}
  nav a:hover,nav button:hover{background:#262626}
  .wrap{max-width:1320px;margin:auto;padding:16px}
  .grid{display:grid;gap:16px}
  @media(min-width:1200px){.cols-2{grid-template-columns:2fr 1fr}}
  .card{background:var(--card);border:1px solid var(--line);border-radius:12px;padding:14px}
  .toolbar{display:flex;gap:8px;flex-wrap:wrap;align-items:center;margin:8px 0}
  .btn{background:#2a2a2a;border:1px solid #3b3b3b;color:#fff;border-radius:8px;padding:8px 12px;cursor:pointer}
  .btn.ghost{background:transparent;border-style:dashed;color:var(--accent)}
  .btn.bad{background:#351b1b;border-color:#613232}
  .btn.ok{background:#173525;border-color:#2c7a52}
  input,select,textarea{background:#111;border:1px solid #343434;border-radius:8px;padding:8px 10px;color:var(--ink);font:inherit}
  input::placeholder{color:#9aa3b3}
  textarea{min-height:72px;resize:vertical}
  .pill{font-size:12px;color:var(--muted);border:1px solid #343434;border-radius:999px;padding:4px 10px}
  .tag{display:inline-block;margin:4px 6px 0 0;padding:4px 10px;border:1px solid #3c3c3c;border-radius:999px;font-size:12px;cursor:pointer}
  .tag:hover{background:#232323}
  table{width:100%;border-collapse:collapse;border:1px solid var(--line);border-radius:10px;overflow:hidden}
  thead{background:#202020}
  th,td{padding:10px;border-bottom:1px solid var(--line);text-align:left;vertical-align:top}
  tbody tr:nth-child(odd){background:#151515}
  tbody tr:hover{background:#202020}
  td .name{display:flex;gap:10px;align-items:center;min-width:240px}
  .ico{width:26px;height:26px;border-radius:6px;background:#222;display:grid;place-items:center;font-size:15px}
  .pdf{color:#ff6b6b}.doc{color:#63a6ff}.xls{color:#2ecc71}.zip{color:#f0b23e}.txt{color:#cfcfcf}
  .star{cursor:pointer;font-size:18px;line-height:1}
  .star.on{color:#ffd86b}
  .right{display:flex;gap:6px;justify-content:flex-end;flex-wrap:wrap}
  .hint{font-size:12px;color:var(--muted)}
  .modal{position:fixed;inset:0;background:#000c;display:none;align-items:center;justify-content:center;z-index:60}
  .modal.open{display:flex}
  .modal .box{width:1100px;max-width:95vw;max-height:92vh;background:#111;border:1px solid #343434;border-radius:12px;display:flex;flex-direction:column}
  .modal .hd{display:flex;align-items:center;justify-content:space-between;padding:10px 12px;border-bottom:1px solid #343434}
  .modal .bd{padding:0;height:80vh}
  .modal iframe{width:100%;height:100%;border:0;background:#000}
  @media print{ nav,.toolbar,.modal{display:none!important} }
</style>
</head>
<body>
<header>
  <h1>Dokumenty ‚Ä¢ ARKON CRM</h1>
  <div class="small">Wzory um√≥w i o≈õwiadcze≈Ñ. Wyszukiwarka, sortowanie, tagi, podglƒÖd PDF (inline). Dane pomocnicze zapisujƒÖ siƒô lokalnie.</div>
</header>

<nav>
  <a href="index.html">Pulpit</a>
  <a href="dokumenty.html" aria-current="page">Dokumenty</a>
  <button id="btnAll" type="button">Wszystkie</button>
  <button id="btnGen" type="button">Og√≥lne</button>
  <button id="btnPref" type="button">Prefinansowanie</button>
  <button id="btnDofi" type="button">Dofinansowanie</button>
</nav>

<div class="wrap grid cols-2">
  <section class="card">
    <div class="toolbar">
      <input id="q" placeholder="üîé Szukaj po nazwie, opisie lub tagu‚Ä¶" style="min-width:260px" aria-label="Szukaj">
      <select id="fType" title="Typ pliku" aria-label="Typ pliku">
        <option value="">Typ: wszystkie</option>
        <option value="pdf">PDF</option>
        <option value="doc">DOC/DOCX</option>
        <option value="xls">XLS/XLSX</option>
        <option value="txt">TXT</option>
        <option value="zip">ZIP</option>
      </select>
      <select id="sort" aria-label="Sortowanie">
        <option value="name.asc">Sort: nazwa ‚Üë</option>
        <option value="name.desc">Sort: nazwa ‚Üì</option>
        <option value="fav.desc">Sort: ulubione ‚Üí</option>
        <option value="mod.desc">Sort: ostatnio modyfikowane</option>
      </select>
      <span class="pill">Widocznych: <b id="countVis">0</b></span>
      <div class="right" style="margin-left:auto">
        <button id="btnExportCSV" class="btn ghost" type="button">CSV (lista)</button>
        <label class="btn ghost" title="Wczytaj lokalne pliki ≈ºeby pobraƒá ich datƒô modyfikacji (bez wysy≈Çania)">
          Wczytaj metadane<input id="pickMeta" type="file" multiple hidden>
        </label>
        <button id="btnReset" class="btn bad" type="button" title="Czy≈õci tylko opisy/tagi/ulubione w przeglƒÖdarce">Wyczy≈õƒá notatki</button>
      </div>
    </div>

    <div style="overflow:auto">
      <table id="tblDocs" role="grid" aria-label="Tabela dokument√≥w">
        <thead>
          <tr>
            <th>‚òÖ</th>
            <th>Nazwa</th>
            <th>Opis (edytowalny)</th>
            <th>Tagi</th>
            <th>Ost. modyfikacja</th>
            <th>Akcje</th>
          </tr>
        </thead>
        <tbody id="tbody"></tbody>
      </table>
    </div>
  </section>

  <aside class="grid">
    <div class="card">
      <b>Szybkie filtry (tagi)</b>
      <div class="small" style="margin-top:8px">
        <div class="list-reset" id="quickTags"></div>
      </div>
      <div class="hint" style="margin-top:8px">Kliknij tag, aby filtrowaƒá. Ponowne klikniƒôcie usuwa filtr.</div>
    </div>

    <div class="card small">
      <b>Gdy PDF ‚Äûnie wczytuje siƒô‚Äù:</b>
      <ol>
        <li>Sprawd≈∫ <i>dok≈ÇadnƒÖ</i> nazwƒô (polskie znaki, spacje/my≈õlniki).</li>
        <li>Plik musi le≈ºeƒá w tym samym katalogu co ta strona.</li>
        <li>Diakrytyki mogƒÖ mieƒá r√≥≈ºne formy Unicode (NFC/NFD) ‚Äî mo≈ºna te≈º tymczasowo zmieniƒá nazwƒô na ASCII.</li>
      </ol>
    </div>
  </aside>
</div>

<!-- MODAL PREVIEW -->
<div id="modal" class="modal" role="dialog" aria-modal="true" aria-labelledby="mTitle">
  <div class="box">
    <div class="hd">
      <div id="mTitle"><b>PodglƒÖd</b></div>
      <div class="right">
        <a id="mOpen" class="btn ghost" href="#" target="_blank" rel="noopener">Otw√≥rz w nowej karcie</a>
        <button id="mClose" class="btn" type="button">Zamknij</button>
      </div>
    </div>
    <div class="bd"><iframe id="mFrame" src="about:blank" title="PodglƒÖd dokumentu"></iframe></div>
  </div>
</div>

<script>
'use strict';

/* ===== helpers ===== */
const $ = s => document.querySelector(s);
const $$ = s => Array.from(document.querySelectorAll(s));
const INT = new Intl.NumberFormat('pl-PL',{maximumFractionDigits:0});
const fmtDate = ts => ts ? new Date(ts).toLocaleString('pl-PL') : '‚Äî';
const fileExt = n => (n.split('.').pop()||'').toLowerCase();
const sl = (s) => (s||'').toString().toLowerCase();
const CSVesc = v => { let s = String(v==null?'':v); return /[\";\n]/.test(s) ? '"' + s.replace(/\"/g,'""') + '"' : s; };

/* ===== local storage for notes ===== */
const LS_KEY = 'arkon_docs_notes_v1'; // { [fileName]: {desc, tags:string[], fav:boolean, mod?:number}}
let notes = load(LS_KEY, {});

function load(key, fallback){
  try{ return JSON.parse(localStorage.getItem(key) || JSON.stringify(fallback)); }catch{ return fallback; }
}
function saveNotes(){
  localStorage.setItem(LS_KEY, JSON.stringify(notes));
  buildQuickTags();
}

/* ===== pliki ===== */
const FILES = [
  /* OG√ìLNE */
  { name:'UMOWA Z WYKONAWCAÃ®  arkon.pdf', href:'UMOWA Z WYKONAWCAÃ®  arkon.pdf',
    desc:'Wz√≥r umowy z WykonawcƒÖ (PDF).', tags:['umowa','og√≥lne','prefinansowanie','dofinansowanie'] },
  { name:'PE≈ÅNOMOCNICTWO.docx', href:'PE≈ÅNOMOCNICTWO.docx',
    desc:'Pe≈Çnomocnictwo do reprezentowania w programie/urzƒôdzie.', tags:['pe≈Çnomocnictwo','og√≥lne','prefinansowanie','dofinansowanie'] },
  { name:'OSÃÅWIADCZENIE WSPOÃÅ≈ÅMA≈ÅZÃáONKA.docx', href:'OSÃÅWIADCZENIE WSPOÃÅ≈ÅMA≈ÅZÃáONKA.docx',
    desc:'Zgoda wsp√≥≈Çma≈Ç≈ºonka na wykonanie zakresu/zg≈Çoszenie.', tags:['o≈õwiadczenie','og√≥lne','prefinansowanie','dofinansowanie'] },
  { name:'OSÃÅWIADCZENIE WSPOÃÅ≈ÅW≈ÅASÃÅCICIELA.docx', href:'OSÃÅWIADCZENIE WSPOÃÅ≈ÅW≈ÅASÃÅCICIELA.docx',
    desc:'Zgoda wsp√≥≈Çw≈Ça≈õciciela nieruchomo≈õci na realizacjƒô inwestycji.', tags:['o≈õwiadczenie','og√≥lne','prefinansowanie','dofinansowanie'] },
  { name:'7188a6a8-7977-4e81-8ce6-7410c21c9b25.pdf', href:'7188a6a8-7977-4e81-8ce6-7410c21c9b25.pdf',
    desc:'Dokument PDF (identyfikator).', tags:['og√≥lne','pdf'] },

  /* PREFINANSOWANIE ‚Äî + zaliczka, protok√≥≈Ç */
  { name:'zalacznik_do_instrukcji_wniosku_o_dofinansowanie_wzor_dyspozycji_wyplaty_zaliczki-14-06-2024.pdf',
    href:'zalacznik_do_instrukcji_wniosku_o_dofinansowanie_wzor_dyspozycji_wyplaty_zaliczki-14-06-2024.pdf',
    desc:'Wz√≥r dyspozycji wyp≈Çaty zaliczki.', tags:['prefinansowanie','zaliczka','pdf'] },
  { name:'PROTOK√ì≈Å ODBIORU PRAC.docx', href:'PROTOK√ì≈Å ODBIORU PRAC.docx',
    desc:'Protok√≥≈Ç odbioru prac (DOCX).', tags:['prefinansowanie','protok√≥≈Ç'] },
  { name:'protokolu_odbioru_prac_wykonawcy.pdf', href:'protokolu_odbioru_prac_wykonawcy.pdf',
    desc:'Protok√≥≈Ç odbioru prac (PDF).', tags:['prefinansowanie','protok√≥≈Ç','pdf'] },

  /* DOFINANSOWANIE ‚Äî + zap≈Çata, PB-5 */
  { name:'OSÃÅWIADCZENIE O DOKONANIU ZAP≈ÅATY.docx', href:'OSÃÅWIADCZENIE O DOKONANIU ZAP≈ÅATY.docx',
    desc:'O≈õwiadczenie potwierdzajƒÖce dokonanie zap≈Çaty.', tags:['dofinansowanie','o≈õwiadczenie','p≈Çatno≈õƒá'] },
  { name:'oswiadczenie_o_posiadanym_prawie_do_dysponowania_nieruchomoscia_na_cele_budowlane_pb-5v11.docx',
    href:'oswiadczenie_o_posiadanym_prawie_do_dysponowania_nieruchomoscia_na_cele_budowlane_pb-5v11.docx',
    desc:'PB-5 v11: o≈õwiadczenie o prawie do dysponowania nieruchomo≈õciƒÖ.', tags:['dofinansowanie','o≈õwiadczenie'] }
];

/* ===== stan & UI ===== */
let filter = { q:'', type:'', sort:'name.asc', tag:'' };

/* tag z URL (?tag=dofinansowanie) */
const usp = new URLSearchParams(location.search);
if(usp.get('tag')){ filter.tag = usp.get('tag'); }

$('#q').addEventListener('input', e=>{ filter.q=e.target.value; render(); });
$('#fType').addEventListener('change', e=>{ filter.type=e.target.value; render(); });
$('#sort').addEventListener('change', e=>{ filter.sort=e.target.value; render(); });
$('#btnReset').addEventListener('click', ()=>{ 
  if(!confirm('Wyczy≈õciƒá lokalne opisy, tagi i ulubione?')) return;
  notes = {}; saveNotes(); render();
});
$('#btnExportCSV').addEventListener('click', exportCSV);
$('#pickMeta').addEventListener('change', handlePickMeta);

/* szybkie filtry ‚Äî dzia≈Çy */
$('#btnAll').addEventListener('click', ()=>{ filter.tag=''; render(); });
$('#btnGen').addEventListener('click', ()=>{ filter.tag='og√≥lne'; render(); });
$('#btnPref').addEventListener('click', ()=>{ filter.tag='prefinansowanie'; render(); });
$('#btnDofi').addEventListener('click', ()=>{ filter.tag='dofinansowanie'; render(); });

/* ===== render ===== */
function applyFilters(rows){
  // scal notatki (desc/tags/fav/mod)
  rows = rows.map(r=>{
    const n = notes[r.name] || {};
    return Object.assign({}, r, { _desc: n.desc ?? r.desc ?? '', _tags: Array.isArray(n.tags)? n.tags : (r.tags||[]), _fav: !!n.fav, _mod: n.mod || 0 });
  });

  if(filter.q){
    const q = sl(filter.q);
    rows = rows.filter(r => sl(r.name).includes(q) || sl(r._desc).includes(q) || (r._tags||[]).some(t=>sl(t).includes(q)));
  }
  if(filter.type){
    rows = rows.filter(r=>{
      const ext = fileExt(r.name);
      if(filter.type==='doc') return ['doc','docx'].includes(ext);
      if(filter.type==='xls') return ['xls','xlsx'].includes(ext);
      return ext===filter.type;
    });
  }
  if(filter.tag){
    const t = sl(filter.tag);
    rows = rows.filter(r => (r._tags||[]).some(x=>sl(x)===t));
  }

  rows.sort((a,b)=>{
    switch(filter.sort){
      case 'name.asc':  return a.name.localeCompare(b.name,'pl',{sensitivity:'base'});
      case 'name.desc': return b.name.localeCompare(a.name,'pl',{sensitivity:'base'});
      case 'fav.desc':  return (b._fav?1:0) - (a._fav?1:0) || a.name.localeCompare(b.name,'pl');
      case 'mod.desc':  return (b._mod||0) - (a._mod||0) || a.name.localeCompare(b.name,'pl');
      default: return 0;
    }
  });
  return rows;
}

function render(){
  let rows = applyFilters(FILES.slice());
  $('#countVis').textContent = rows.length;
  const tb = $('#tbody'); tb.innerHTML='';

  if(!rows.length){
    tb.innerHTML = '<tr><td colspan="6" class="small">Brak wynik√≥w dla bie≈ºƒÖcych filtr√≥w.</td></tr>';
    return;
  }

  rows.forEach(file=>{
    const tr = document.createElement('tr');
    // ‚òÖ ulubione
    const tdFav = document.createElement('td');
    const star = document.createElement('span');
    star.className = 'star' + (file._fav?' on':'');
    star.textContent = file._fav ? '‚òÖ' : '‚òÜ';
    star.title = file._fav ? 'Usu≈Ñ z ulubionych' : 'Dodaj do ulubionych';
    star.addEventListener('click', ()=>{
      const n = notes[file.name] || {};
      n.fav = !file._fav;
      notes[file.name] = n; saveNotes(); render();
    });
    tdFav.appendChild(star);

    // Nazwa + ikonka
    const tdName = document.createElement('td');
    const box = document.createElement('div'); box.className='name';
    const ico = document.createElement('div');
    const ext = fileExt(file.name);
    ico.className = 'ico ' + (ext==='pdf'?'pdf': (['doc','docx'].includes(ext)?'doc': (['xls','xlsx'].includes(ext)?'xls': (ext==='zip'?'zip': (ext==='txt'?'txt':'')))));
    ico.textContent = ext==='pdf'?'üìÑ': (['doc','docx'].includes(ext)?'üìù': (['xls','xlsx'].includes(ext)?'üìä': (ext==='zip'?'üóú':'üìÑ')));
    const a = document.createElement('a'); a.href=encodeURI(file.href); a.textContent=file.name; a.title='Otw√≥rz';
    a.addEventListener('click', (e)=>{
      // PDF podglƒÖd w modalu; inne ‚Äî standardowo
      if(fileExt(file.name)==='pdf'){
        e.preventDefault();
        openPreview(file);
      }
    });
    box.appendChild(ico); box.appendChild(a);
    tdName.appendChild(box);

    // Opis (edytowalny)
    const tdDesc = document.createElement('td');
    const ta = document.createElement('textarea'); ta.placeholder='Opis dokumentu‚Ä¶'; ta.value=file._desc||'';
    ta.addEventListener('input', debounce(()=>{ setNote(file.name, {desc:ta.value}); }, 200));
    tdDesc.appendChild(ta);

    // Tagi (edytowalne, po przecinku)
    const tdTags = document.createElement('td');
    const inpTags = document.createElement('input'); inpTags.placeholder='np. umowa, prawne'; inpTags.value=(file._tags||[]).join(', ');
    inpTags.addEventListener('input', debounce(()=>{
      const tags = inpTags.value.split(',').map(s=>s.trim()).filter(Boolean);
      setNote(file.name, {tags});
    }, 200));
    tdTags.appendChild(inpTags);

    // Ost. modyfikacja
    const tdMod = document.createElement('td');
    tdMod.textContent = file._mod ? fmtDate(file._mod) : '‚Äî';

    // Akcje
    const tdAct = document.createElement('td');
    tdAct.className='right';
    const btnOpen = document.createElement('a');
    btnOpen.className='btn ghost'; btnOpen.href=encodeURI(file.href); btnOpen.target='_blank'; btnOpen.rel='noopener';
    btnOpen.textContent = 'Otw√≥rz';
    btnOpen.addEventListener('click', (e)=>{
      if(fileExt(file.name)==='pdf'){ e.preventDefault(); openPreview(file); }
    });
    const btnDl = document.createElement('a');
    btnDl.className='btn'; btnDl.href=encodeURI(file.href); btnDl.download=file.name; btnDl.textContent='Pobierz';

    tdAct.appendChild(btnOpen);
    tdAct.appendChild(btnDl);

    tr.appendChild(tdFav);
    tr.appendChild(tdName);
    tr.appendChild(tdDesc);
    tr.appendChild(tdTags);
    tr.appendChild(tdMod);
    tr.appendChild(tdAct);

    $('#tbody').appendChild(tr);
  });
}

/* ===== tag chmura ===== */
function buildQuickTags(){
  const box = $('#quickTags'); box.innerHTML='';
  const map = new Map();
  FILES.forEach(f=>{ (f.tags||[]).forEach(t=> map.set(t, (map.get(t)||0)+1)); });
  Object.values(notes).forEach(n=>{ (n.tags||[]).forEach(t=> map.set(t, (map.get(t)||0)+1)); });

  if(map.size===0){ box.innerHTML='<div class="small">Brak tag√≥w. Dodaj w tabeli.</div>'; return; }

  const sorted = [...map.entries()].sort((a,b)=> b[1]-a[1]);
  sorted.slice(0,30).forEach(([tag,count])=>{
    const btn = document.createElement('button');
    btn.className='tag'; btn.type='button';
    btn.textContent = tag + ' ('+count+')';
    btn.addEventListener('click', ()=>{
      filter.tag = (filter.tag===tag ? '' : tag);
      render();
    });
    if(filter.tag===tag){ btn.style.background='#262626'; btn.style.borderColor='#4a4a4a'; }
    box.appendChild(btn);
  });
}

/* ===== notatki ===== */
function setNote(name, part){
  const n = notes[name] || {};
  Object.assign(n, part);
  notes[name] = n;
  saveNotes();
}

/* ===== preview modal (PDF) ===== */
const modal = $('#modal'), mFrame = $('#mFrame'), mOpen = $('#mOpen'), mTitle = $('#mTitle');
$('#mClose').addEventListener('click', closePreview);
function openPreview(file){
  mTitle.textContent = file.name;
  mFrame.src = encodeURI(file.href);
  mOpen.href = encodeURI(file.href);
  modal.classList.add('open');
}
function closePreview(){
  mFrame.src = 'about:blank';
  modal.classList.remove('open');
}

/* ===== wczytaj metadane z lokalnych plik√≥w ===== */
async function handlePickMeta(e){
  const files = Array.from(e.target.files||[]);
  if(!files.length) return;
  let changed = 0;
  files.forEach(f=>{
    const match = FILES.find(x=>x.name===f.name);
    if(!match) return;
    const n = notes[match.name] || {};
    n.mod = f.lastModified || Date.now();
    notes[match.name] = n;
    changed++;
  });
  saveNotes();
  if(changed===0) alert('Nie dopasowano nazw ‚Äî upewnij siƒô, ≈ºe wybierasz te same pliki.');
  render();
  e.target.value = '';
}

/* ===== eksport CSV ===== */
function exportCSV(){
  const rows = applyFilters(FILES.slice());
  const out = [['Ulubione','Nazwa','Opis','Tagi','Ost. modyfikacja','≈öcie≈ºka']];
  rows.forEach(r=>{
    out.push([
      r._fav?'TAK':'NIE',
      r.name,
      (r._desc||'').replace(/\s+/g,' ').trim(),
      (r._tags||[]).join('|'),
      r._mod? new Date(r._mod).toISOString() : '',
      r.href
    ]);
  });
  const csv = out.map(line=>line.map(CSVesc).join(';')).join('\n');
  const blob = new Blob([csv], {type:'text/csv;charset=utf-8'});
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = 'arkon_dokumenty.csv';
  a.click();
  URL.revokeObjectURL(a.href);
}

/* ===== debounce ===== */
function debounce(fn,ms){ let t; return function(){ const a=arguments; clearTimeout(t); t=setTimeout(()=>fn.apply(null,a), ms||180); }; }

/* ===== init ===== */
function init(){
  // zasiej domy≈õlne opisy/tagi je≈õli brak notatek
  FILES.forEach(f=>{
    if(!notes[f.name]){
      notes[f.name] = { desc:f.desc||'', tags:(f.tags||[]), fav:false };
    }
  });
  saveNotes();
  buildQuickTags();
  render();
}
init();
</script>
</body>
</html>
index.html (Pulpit / z dodatkowym przej≈õciem ‚ÄûPrzesy≈Ç dokument√≥w ‚Üí Dokumenty‚Äù)
W Twoim pliku doda≈Çam w sekcji Skr√≥ty przycisk, kt√≥ry prowadzi bezpo≈õrednio do listy dokument√≥w ‚Äî tak jak prosi≈Ça≈õ, ‚Äûz przej≈õcia ‚Äì przesy≈Ç dokument√≥w‚Äù.

html
Kopiuj
Edytuj
<!doctype html>
<html lang="pl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>ARKON ‚Äî Pulpit / Indeks</title>
<meta name="description" content="Strona g≈Ç√≥wna ARKON CRM: logowanie, szybkie podglƒÖdy, skr√≥ty, ostatnie rekordy, nawigacja do wszystkich modu≈Ç√≥w.">
<link rel="icon" type="image/svg+xml" href="pv-icon.svg">
<link rel="alternate icon" href="pv-icon.svg">
<link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ccircle cx='50' cy='50' r='48' fill='%230b8d3b'/%3E%3Ctext x='50' y='62' font-size='60' text-anchor='middle' fill='white' font-family='Arial,Helvetica,sans-serif'%3EA%3C/text%3E%3C/svg%3E">
<style>
  :root{
    --bg:#0b1020; --grad1:#0a1028; --grad2:#0d1536;
    --ink:#e8edff; --muted:#aeb8da; --line:#22306a;
    --card:#0f1636; --chip:#16245a; --accent:#4cc9f0;
    --ok:#2fbf71; --warn:#ffb84d; --bad:#ff6b6b;
    --focus:#82c4ff;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{margin:0;font:15px/1.55 system-ui,Segoe UI,Roboto,Arial;background:linear-gradient(180deg,var(--grad1),var(--grad2));color:var(--ink)}
  a{color:#cfe0ff;text-decoration:none}
  header{padding:16px;border-bottom:1px solid var(--line);background:#0e1534;position:sticky;top:0;z-index:8}
  header h1{margin:0;font-size:22px}
  header .muted{color:var(--muted);font-size:13px}
  nav{display:flex;gap:10px;flex-wrap:wrap;padding:10px 16px;border-bottom:1px solid var(--line);background:#121a44}
  nav a{padding:8px 12px;border-radius:999px;border:1px solid #2a3a75}
  nav a:hover{background:#1a2758}
  .wrap{max-width:1280px;margin:0 auto;padding:16px}
  .grid{display:grid;gap:14px}
  @media(min-width:1100px){ .cols-3{grid-template-columns:repeat(3,1fr)} .cols-2{grid-template-columns:2fr 1fr} }
  .card{background:linear-gradient(180deg,#0f1636,#0f1a42);border:1px solid var(--line);border-radius:14px;padding:14px}
  .row{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
  .pill{display:inline-block;background:#0d1530;border:1px dashed #2b3a77;border-radius:999px;padding:6px 10px;color:#aeb8da;font-size:13px}
  .btn{background:#233261;border:1px solid #3a4ca3;color:#fff;border-radius:10px;padding:8px 12px;cursor:pointer}
  .btn.ghost{background:transparent;border:1px dashed #3a4ca3}
  .btn.bad{background:#3a1f2a;border-color:#7b3341}
  .btn.ok{background:#194d34;border-color:#2f9762}
  .kbd{font:12px/1.2 ui-monospace,Menlo,Consolas,monospace;background:#101735;border:1px solid #2a3777;padding:2px 6px;border-radius:6px;color:#cfe0ff}
  table{width:100%;border-collapse:separate;border-spacing:0}
  th,td{padding:8px 6px;border-bottom:1px solid #1a244d;text-align:left;vertical-align:top}
  th{font-size:12px;color:var(--muted)}
  .small{font-size:12px;color:var(--muted)}
  .right{display:flex;gap:8px;justify-content:flex-end}
  .kpi{display:flex;align-items:center;gap:12px}
  .kpi .n{font-weight:700;font-size:20px}
  .ok{color:#7ee2ab} .warn{color:#ffd699} .bad{color:#ffb1b1}
  .list-reset{list-style:none;margin:0;padding:0}
  .status{padding:2px 8px;border-radius:999px;font-size:12px;border:1px solid #2a3a75;background:#0f1a44}
  .status.lead{background:#19224e}
  .status.q{background:#21305f}
  .status.w{background:#24336b}
  .status.c{background:#1d3d2f}
  .status.l{background:#4a1d1d}
  .apps{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:12px}
  .app{display:block;padding:14px;border-radius:12px;background:#111a42;border:1px solid #2a3a75}
  .app b{display:block;margin-bottom:4px}
  .app:hover{background:#16235a}
  .tag{display:inline-block;margin:2px 6px 0 0;padding:3px 8px;border:1px solid #3a4ca3;border-radius:999px;font-size:12px}
  .grid-2{display:grid;grid-template-columns:1fr 1fr;gap:8px}
  @media(max-width:720px){ .grid-2{grid-template-columns:1fr} }
  @media print{ #lock,nav,.btn,.kbd{display:none!important} }

  /* ===== LOCK / LOGIN OVERLAY ===== */
  #lock{position:fixed;inset:0;background:radial-gradient(1200px 600px at 60% -10%,#19307144,transparent),linear-gradient(180deg,#0a0f22 0%,#0a0f22 30%,#0b1130 100%);backdrop-filter:blur(2px);display:none;align-items:center;justify-content:center;z-index:9999}
  #lock.open{display:flex}
  .login-panel{width:460px;max-width:94vw;background:linear-gradient(180deg,#0f1636,#101a44);border:1px solid #2a3a75;border-radius:16px;padding:16px;box-shadow:0 20px 60px #0008}
  .login-panel h2{margin:0 0 4px}
  .login-panel .muted{margin-bottom:8px}
  .field{width:100%;background:#0d1530;border:1px solid #28356c;color:#e8edff;border-radius:10px;padding:10px 12px;outline:0}
  .field:focus{border-color:#3e61cc;box-shadow:0 0 0 3px #3e61cc33}
  .row-sb{display:flex;justify-content:space-between;align-items:center;gap:8px}
  .social{display:flex;gap:8px}
  .btn.icon{display:inline-flex;align-items:center;gap:8px}
  .g{background:#1f3b7a} .f{background:#2d3f75}
  .err{color:#ffb1b1;font-size:13px;height:16px}
  .shake{animation:shake .36s}
  @keyframes shake{10%,90%{transform:translateX(-1px)}20%,80%{transform:translateX(2px)}30%,50%,70%{transform:translateX(-4px)}40%,60%{transform:translateX(4px)}}

  /* user bar */
  .userbar{position:fixed;right:10px;top:10px;display:flex;align-items:center;gap:8px;z-index:9}
  .avatar{width:30px;height:30px;border-radius:50%;display:inline-grid;place-items:center;background:#133; border:1px solid #2a3a75;font-weight:700}
  .online{width:8px;height:8px;border-radius:50%;background:#2fbf71;border:1px solid #0b1}
  .link-like{background:transparent;border:0;color:#cfe0ff;text-decoration:underline;cursor:pointer}
</style>
</head>
<body>

<!-- USER BAR -->
<div class="userbar">
  <span id="ubName" class="small">Go≈õƒá</span>
  <span class="online" title="online"></span>
  <div id="ubAvatar" class="avatar">A</div>
  <button id="btnLogout" class="btn ghost" title="Wyloguj">Wyloguj</button>
  <button id="btnLock" class="btn ghost" title="Zablokuj ekran">Zablokuj</button>
</div>

<header>
  <h1>Pulpit ‚Ä¢ ARKON CRM</h1>
  <div class="small">Szybki podglƒÖd i skr√≥ty. Wszystkie dane lokalnie (LocalStorage/IndexedDB).</div>
</header>

<nav aria-label="Nawigacja g≈Ç√≥wna">
  <a href="index.html" aria-current="page">üè† Pulpit</a>
  <a href="klienci.html">üë• Klienci</a>
  <a href="lidy.html">üß≤ Lidy</a>
  <a href="komponenty.html">üß© Komponenty</a>
  <a href="upload.html">üì§ Przesy≈Ç plik√≥w</a>
  <a href="dokumenty.html">üìÑ Dokumenty</a>
  <a href="chat.html">üí¨ Komunikator</a>
  <a href="ustawienia.html">‚öô Ustawienia</a>
  <a href="kalkulator.html" target="_blank" rel="noopener">üßÆ Kalkulator ‚ÜóÔ∏è</a>
  <a href="baza.html">üóÉ Baza (storage)</a>
  <a href="kalendarz-montaze.html">üìÖ Kalendarz monta≈ºy</a>
</nav>

<div class="wrap grid cols-2" id="panel">
  <!-- LEWA KOLUMNA -->
  <section class="grid">
    <!-- KPI -->
    <div class="grid cols-3">
      <div class="card"><div class="kpi"><div>üë•</div><div><div class="small">Klienci</div><div id="kpiClients" class="n">0</div></div></div></div>
      <div class="card"><div class="kpi"><div>üß≤</div><div><div class="small">Lidy</div><div id="kpiLeads" class="n">0</div></div></div></div>
      <div class="card"><div class="kpi"><div>üß©</div><div><div class="small">Komponenty</div><div id="kpiComp" class="n">0</div></div></div></div>
    </div>

    <!-- Skr√≥ty -->
    <div class="card">
      <div class="row" style="justify-content:space-between">
        <div><b>Skr√≥ty</b></div>
        <div class="small">Tip: <span class="kbd">/</span> ‚Äî szukaj klienta ‚Ä¢ <span class="kbd">Alt+N</span> ‚Äî nowy klient</div>
      </div>
      <div class="row" style="margin-top:6px">
        <a class="btn ok" href="klienci.html">+ Nowy klient</a>
        <a class="btn" href="lidy.html">+ Nowy lead</a>
        <a class="btn ghost" href="komponenty.html">Dodaj komponent</a>
        <a class="btn ghost" href="upload.html">Wy≈õlij pliki</a>
        <!-- NOWY skr√≥t: Przesy≈Ç dokument√≥w -> Dokumenty -->
        <a class="btn" href="dokumenty.html" title="Po przesy≈Çce przejd≈∫ do listy dokument√≥w">Przesy≈Ç dokument√≥w ‚Üí Dokumenty</a>
        <a class="btn" href="kalkulator.html" target="_blank" rel="noopener">Kalkulator ‚ÜóÔ∏è</a>
      </div>
    </div>

    <!-- Ostatni klienci -->
    <div class="card">
      <div class="row" style="justify-content:space-between"><b>Ostatnio dodani klienci</b><a class="small" href="klienci.html">Zobacz wszystkich ‚Üí</a></div>
      <div style="overflow:auto;margin-top:6px">
        <table id="tblClients">
          <thead><tr><th>Nazwa</th><th>Status</th><th>Kontakt</th><th>Tagi</th><th>Dodano</th></tr></thead>
          <tbody></tbody>
        </table>
      </div>
    </div>

    <!-- Ostatnie lidy -->
    <div class="card">
      <div class="row" style="justify-content:space-between"><b>Ostatnie lidy</b><a class="small" href="lidy.html">Zobacz wszystkie ‚Üí</a></div>
      <div style="overflow:auto;margin-top:6px">
        <table id="tblLeads">
          <thead><tr><th>Tytu≈Ç</th><th>≈πr√≥d≈Ço</th><th>Status</th><th>Data</th></tr></thead>
          <tbody></tbody>
        </table>
      </div>
    </div>
  </section>

  <!-- PRAWA KOLUMNA -->
  <aside class="grid">
    <!-- Modu≈Çy -->
    <div class="card">
      <b>Modu≈Çy</b>
      <div class="apps" style="margin-top:8px">
        <a class="app" href="klienci.html"><b>Klienci</b><span class="small">Lista, edycja, projekty, dokumenty, pola w≈Çasne.</span></a>
        <a class="app" href="lidy.html"><b>Lidy</b><span class="small">Zbieranie i kwalifikacja lead√≥w.</span></a>
        <a class="app" href="komponenty.html"><b>Komponenty</b><span class="small">Pompy, piece, PV, ocieplenie, bramy.</span></a>
        <a class="app" href="upload.html"><b>Przesy≈Ç plik√≥w</b><span class="small">Po wgraniu: przejd≈∫ do <a href="dokumenty.html"><u>Dokument√≥w</u></a>.</span></a>
        <a class="app" href="dokumenty.html"><b>Dokumenty</b><span class="small">Wzory um√≥w i szablony.</span></a>
        <a class="app" href="chat.html"><b>Komunikator</b><span class="small">Zespo≈Çowy czat + za≈ÇƒÖczniki.</span></a>
        <a class="app" href="ustawienia.html"><b>Ustawienia</b><span class="small">Preferencje, wydruk do PDF.</span></a>
        <a class="app" href="baza.html"><b>Baza</b><span class="small">PodglƒÖd pamiƒôci lokalnej.</span></a>
        <a class="app" href="kalkulator.html" target="_blank" rel="noopener"><b>Kalkulator</b><span class="small">Symulacje i kosztorysy.</span></a>
        <a class="app" href="kalendarz-montaze.html"><b>Kalendarz monta≈ºy</b><span class="small">Planowanie ekip i termin√≥w.</span></a>
      </div>
    </div>

    <!-- Komponenty szybki podglƒÖd -->
    <div class="card">
      <b>Komponenty ‚Äî szybki podglƒÖd</b>
      <div class="grid-2 small" style="margin-top:6px">
        <div>Pompy: <b id="cmp_pumps">0</b></div>
        <div>Piece/Kot≈Çy: <b id="cmp_boilers">0</b></div>
        <div>Fotowoltaika: <b id="cmp_pv">0</b></div>
        <div>Ocieplenie: <b id="cmp_insul">0</b></div>
        <div>Bramy: <b id="cmp_garage">0</b></div>
      </div>
      <div class="right" style="margin-top:8px">
        <a class="btn ghost" href="komponenty.html">Otw√≥rz komponenty</a>
      </div>
    </div>

    <!-- Notatki -->
    <div class="card">
      <b>Szybka notatka</b>
      <textarea id="note" placeholder="Twoja notatka (zapis lokalny)" style="width:100%;min-height:100px;margin-top:8px"></textarea>
      <div class="right" style="margin-top:8px"><button id="btnClearNote" class="btn ghost">Wyczy≈õƒá</button></div>
      <div class="small" style="margin-top:6px">Przechowywane w <code>localStorage</code> (klucz: <code>arkon_note</code>).</div>
    </div>
  </aside>
</div>

<!-- LOCK / LOGIN -->
<div id="lock" class="open" aria-modal="true" role="dialog">
  <form id="loginForm" class="login-panel" autocomplete="off">
    <h2>üîí ARKON CRM ‚Äî logowanie</h2>
    <div class="muted">Zabezpieczony dostƒôp do pulpitu (pozosta≈Çe modu≈Çy bez has≈Ça).</div>
    <div class="row" style="gap:10px;align-items:center;margin:8px 0">
      <div class="avatar" id="lpAvatar" aria-hidden="true">A</div>
      <div class="small" id="lpWelcome">Witaj! Zaloguj siƒô, aby przej≈õƒá do panelu.</div>
    </div>
    <div style="display:grid;gap:8px;margin-top:6px">
      <label class="small">U≈ºytkownik</label>
      <input id="loginUser" class="field" inputmode="email" placeholder="np. u≈ºytkownik" aria-label="U≈ºytkownik" required>
      <label class="small">Has≈Ço</label>
      <div style="display:grid;grid-template-columns:1fr auto;gap:6px">
        <input id="loginPass" class="field" type="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" aria-label="Has≈Ço" required>
        <button type="button" id="togglePass" class="btn ghost" aria-label="Poka≈º/ukryj has≈Ço">üëÅ</button>
      </div>
      <div class="row" style="justify-content:space-between;align-items:center">
        <label class="small" style="display:flex;align-items:center;gap:6px">
          <input id="rememberMe" type="checkbox"> Pamiƒôtaj mnie (7 dni)
        </label>
        <button type="button" id="forgot" class="link-like">Zapomnia≈Çe≈õ has≈Ça?</button>
      </div>
      <div id="err" class="err"></div>
      <button class="btn ok" type="submit">Zaloguj</button>
      <div class="small" style="text-align:center;opacity:.85">lub</div>
      <div class="social">
        <button type="button" id="loginGoogle" class="btn icon g">G Zaloguj przez Google</button>
        <button type="button" id="loginFacebook" class="btn icon f">f Zaloguj przez Facebook</button>
      </div>
    </div>
  </form>
</div>

<script>
'use strict';
/* ===== helpers ===== */
const $  = s => document.querySelector(s);
const $$ = s => Array.from(document.querySelectorAll(s));
const INT = new Intl.NumberFormat('pl-PL',{maximumFractionDigits:0});
const fmtDate = ts => new Date(ts||Date.now()).toLocaleString('pl-PL');
function escapeHtml(s){ return (s==null?'':String(s)).replace(/[&<>"]/g, c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;'}[c])); }

/* ===== storage keys ===== */
const LS = {
  clients: 'arkon_clients_v1',
  leads:   'arkon_leads_v1',
  cmp: {
    pumps:  'arkon_cmp_pumps_v1',
    boilers:'arkon_cmp_boilers_v1',
    pv:     'arkon_cmp_pv_v1',
    insul:  'arkon_cmp_insul_v1',
    garage: 'arkon_cmp_garage_v1'
  },
  note: 'arkon_note',
  authToken: 'arkon_auth_token_v1',
  authSession: 'arkon_auth_session_v1'
};

/* ===== AUTH (local-only) ===== */
const USER_HASH = 'cc6c7f1d16552c14bc8aaa46f3f869743c08c26d7e3c66fd58ee6c304cf5d5ac'; // sha256("Arkon2")
const PASS_HASH = '2fdc3bfddb6c06d9572b7a69c5012742b63d83a1f01c5254dc1fd0fa33352a93'; // sha256("Szybkakasa")

async function sha256Hex(str){
  const enc = new TextEncoder().encode(str);
  const buf = await crypto.subtle.digest('SHA-256', enc);
  return Array.from(new Uint8Array(buf)).map(b=>b.toString(16).padStart(2,'0')).join('');
}
function isTokenValid(obj){ return obj && obj.exp && obj.exp>Date.now() && obj.user && obj.sig; }
function genSig(uh,ph){ return btoa(uh.slice(0,16)+':'+ph.slice(-16)+':'+Date.now()); }
function setAvatarFromName(name, el){ el.textContent=(name||'A').trim().charAt(0).toUpperCase()||'A'; }

/* ===== LOCK / LOGIN ===== */
const lock = $('#lock');
const loginForm = $('#loginForm');
const loginUser = $('#loginUser');
const loginPass = $('#loginPass');
const rememberMe = $('#rememberMe');
const errBox = $('#err');

$('#togglePass').addEventListener('click', ()=>{ loginPass.type = loginPass.type==='password' ? 'text' : 'password'; });
$('#forgot').addEventListener('click', ()=>{ const u = prompt('Podaj identyfikator u≈ºytkownika:'); if(u) alert('Instrukcje resetu wys≈Çane (symulacja).'); });

$('#loginGoogle').addEventListener('click', ()=>{
  const name='Google User';
  const token={user:name,exp:Date.now()+7*24*3600*1000,sig:genSig(USER_HASH,PASS_HASH),idp:'google'};
  localStorage.setItem(LS.authToken, JSON.stringify(token));
  afterLogin(name,true);
});
$('#loginFacebook').addEventListener('click', ()=>{
  const name='Facebook User';
  const token={user:name,exp:Date.now()+7*24*3600*1000,sig:genSig(USER_HASH,PASS_HASH),idp:'facebook'};
  localStorage.setItem(LS.authToken, JSON.stringify(token));
  afterLogin(name,true);
});

loginForm.addEventListener('submit', async (e)=>{
  e.preventDefault(); errBox.textContent='';
  const uh = await sha256Hex(loginUser.value||'');
  const ph = await sha256Hex(loginPass.value||'');
  if(uh===USER_HASH && ph===PASS_HASH){
    const name = loginUser.value || 'U≈ºytkownik';
    const token = { user:name, exp:Date.now()+(rememberMe.checked?7*24*3600*1000:2*3600*1000), sig:genSig(uh,ph) };
    if(rememberMe.checked){ localStorage.setItem(LS.authToken, JSON.stringify(token)); sessionStorage.removeItem(LS.authSession); }
    else{ sessionStorage.setItem(LS.authSession, JSON.stringify(token)); localStorage.removeItem(LS.authToken); }
    afterLogin(name, rememberMe.checked);
  }else{
    errBox.textContent='Nieprawid≈Çowe dane logowania.';
    loginForm.classList.remove('shake'); void loginForm.offsetWidth; loginForm.classList.add('shake');
    loginPass.value=''; loginPass.focus();
  }
});

function afterLogin(name){
  lock.classList.remove('open'); document.body.style.overflow='';
  $('#ubName').textContent=name; setAvatarFromName(name, $('#ubAvatar'));
  $('#panel').setAttribute('tabindex','-1'); $('#panel').focus({preventScroll:true});
}

/* autologin */
(function(){
  try{
    const rawL=localStorage.getItem(LS.authToken), rawS=sessionStorage.getItem(LS.authSession);
    const obj = rawL ? JSON.parse(rawL) : rawS ? JSON.parse(rawS) : null;
    if(isTokenValid(obj)){ $('#ubName').textContent=obj.user||'U≈ºytkownik'; setAvatarFromName(obj.user, $('#ubAvatar')); lock.classList.remove('open'); document.body.style.overflow=''; }
    else{ lock.classList.add('open'); document.body.style.overflow='hidden'; }
  }catch{ lock.classList.add('open'); document.body.style.overflow='hidden'; }
})();

/* Blokuj/wyloguj */
$('#btnLock').addEventListener('click', ()=>{ lock.classList.add('open'); document.body.style.overflow='hidden'; });
$('#btnLogout').addEventListener('click', ()=>{
  if(confirm('Wylogowaƒá z pulpitu?')){
    localStorage.removeItem(LS.authToken); sessionStorage.removeItem(LS.authSession);
    lock.classList.add('open'); document.body.style.overflow='hidden';
    loginUser.value=''; loginPass.value=''; rememberMe.checked=false;
    $('#ubName').textContent='Go≈õƒá'; setAvatarFromName('A', $('#ubAvatar'));
  }
});

/* ===== KPI ===== */
function load(key, fallback){ try{ return JSON.parse(localStorage.getItem(key) || JSON.stringify(fallback)); }catch{ return fallback; } }
function refreshKPI(){
  const clients = load(LS.clients, []);
  const leads   = load(LS.leads,   []);
  const cmpSum = ['pumps','boilers','pv','insul','garage'].map(k=>load(LS.cmp[k],[]).length).reduce((a,b)=>a+b,0);
  $('#kpiClients').textContent = clients.length;
  $('#kpiLeads').textContent   = leads.length;
  $('#kpiComp').textContent    = cmpSum;

  // komponenty by cat
  $('#cmp_pumps').textContent  = load(LS.cmp.pumps, []).length;
  $('#cmp_boilers').textContent= load(LS.cmp.boilers, []).length;
  $('#cmp_pv').textContent     = load(LS.cmp.pv, []).length;
  $('#cmp_insul').textContent  = load(LS.cmp.insul, []).length;
  $('#cmp_garage').textContent = load(LS.cmp.garage, []).length;
}

/* ===== Recent Clients ===== */
function renderRecentClients(){
  const tb = $('#tblClients tbody'); tb.innerHTML = '';
  const clients = load(LS.clients, []).slice().sort((a,b)=>(b.created||0)-(a.created||0)).slice(0,8);
  if(!clients.length){
    tb.innerHTML = '<tr><td colspan="5" class="small">Brak danych. Dodaj pierwszego klienta w module ‚ÄûKlienci‚Äù.</td></tr>'; return;
  }
  clients.forEach(c=>{
    const tr = document.createElement('tr');
    const tags = (c.tags||[]).slice(0,3).map(t=>'<span class="tag">'+escapeHtml(t)+'</span>').join('');
    tr.innerHTML = `
      <td><a href="klienci.html" title="Otw√≥rz w Klienci"><b>${escapeHtml(c.name||'‚Äî')}</b></a></td>
      <td><span class="status ${statusClass(c.status)}">${escapeHtml(c.status||'‚Äî')}</span></td>
      <td>${escapeHtml(c.email||'')}<div class="small">${escapeHtml(c.phone||'')}</div></td>
      <td>${tags}</td>
      <td>${fmtDate(c.created)}</td>`;
    tb.appendChild(tr);
  });
}

/* ===== Recent Leads ===== */
function renderRecentLeads(){
  const tb = $('#tblLeads tbody'); tb.innerHTML = '';
  const leads = load(LS.leads, []).slice().sort((a,b)=>(b.created||0)-(a.created||0)).slice(0,8);
  if(!leads.length){ tb.innerHTML = '<tr><td colspan="4" class="small">Brak lead√≥w. Dodaj w module ‚ÄûLidy‚Äù.</td></tr>'; return; }
  leads.forEach(l=>{
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td><a href="lidy.html"><b>${escapeHtml(l.title||'Lead')}</b></a></td>
      <td>${escapeHtml(l.source||'')}</td>
      <td>${escapeHtml(l.status||'NOWY')}</td>
      <td>${fmtDate(l.created)}</td>`;
    tb.appendChild(tr);
  });
}

/* ===== Notatka ===== */
function initNote(){
  const el = $('#note');
  el.value = localStorage.getItem(LS.note) || '';
  el.addEventListener('input', ()=> localStorage.setItem(LS.note, el.value));
  $('#btnClearNote').addEventListener('click', ()=>{ if(confirm('Wyczy≈õciƒá notatkƒô?')){ el.value=''; localStorage.removeItem(LS.note); } });
}

/* ===== utils ===== */
function statusClass(s){
  switch((s||'').toUpperCase()){
    case 'LEAD': return 'lead';
    case 'ZAPYTANIE': return 'q';
    case 'W TOKU': return 'w';
    case 'KLIENT': return 'c';
    case 'UTRACONY': return 'l';
    default: return '';
  }
}

/* ===== keyboard shortcuts ===== */
window.addEventListener('keydown', (e)=>{
  if(e.key === '/'){ e.preventDefault(); location.href = 'klienci.html'; }
  if(e.altKey && (e.key==='n' || e.key==='N')){ e.preventDefault(); location.href = 'klienci.html#new'; }
});

/* ===== boot ===== */
refreshKPI();
renderRecentClients();
renderRecentLeads();
initNote();

/* focus helpers */
$('#loginUser').addEventListener('keydown', e=>{ if(e.key==='Enter'){ e.preventDefault(); $('#loginPass').focus(); }});
</script>
</body>
</html>
