<!doctype html>
<html lang="pl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>ARKON CRM â€“ Komunikator</title>
<meta name="description" content="Komunikator CRM z integracjÄ… Supabase.">
<script src="https://unpkg.com/@supabase/supabase-js@2.39.7/dist/umd/supabase.min.js"></script>
<style>
  body{margin:0;font:15px/1.5 system-ui,Segoe UI,Roboto;background:#0b1020;color:#e8edff}
  header{padding:14px;background:#11183a;border-bottom:1px solid #222}
  h1{margin:0;font-size:20px}
  #chat{padding:16px;height:70vh;overflow-y:auto;background:#10182e}
  .msg{margin:6px 0;padding:8px 12px;border-radius:12px;max-width:70%}
  .me{background:#233261;margin-left:auto}
  .other{background:#16244a}
  .meta{font-size:11px;color:#aaa;margin-top:4px}
  #inputZone{display:flex;gap:8px;padding:12px;background:#0f1533;border-top:1px solid #222}
  input,button{font:15px system-ui}
  input{flex:1;padding:8px;border-radius:8px;border:1px solid #444;background:#0d1330;color:#fff}
  button{padding:8px 14px;border:none;border-radius:8px;cursor:pointer;background:#4cc9f0;color:#000}
  button:hover{background:#36b2d8}
</style>
</head>
<body>
<header><h1>ðŸ’¬ Komunikator â€“ ARKON CRM</h1></header>

<div id="chat"></div>

<div id="inputZone">
  <input id="msgInput" placeholder="Napisz wiadomoÅ›Ä‡...">
  <button onclick="sendMsg()">WyÅ›lij</button>
</div>

<script>
  // KONFIGURACJA SUPABASE
  const SUPABASE_URL = "https://phxgjrqiltkzcwnygaha.supabase.co";
  const SUPABASE_ANON_KEY = "<<<TWÃ“J_ANON_KEY_TUTAJ>>>"; // <- podmieÅ„ na swÃ³j klucz publiczny

  const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

  const chatBox = document.getElementById('chat');
  const msgInput = document.getElementById('msgInput');
  const user = "UÅ¼ytkownik_" + Math.floor(Math.random()*1000); // identyfikator tymczasowy

  // Funkcja: wyÅ›wietl wiadomoÅ›Ä‡
  function showMsg(msg, who, ts){
    const div = document.createElement('div');
    div.className = 'msg ' + (who === user ? 'me':'other');
    div.innerHTML = <b>${who}</b><br>${msg}<div class="meta">${new Date(ts).toLocaleString()}</div>;
    chatBox.appendChild(div);
    chatBox.scrollTop = chatBox.scrollHeight;
  }

  // Funkcja: wyÅ›lij wiadomoÅ›Ä‡
  async function sendMsg(){
    const text = msgInput.value.trim();
    if(!text) return;
    msgInput.value = '';
    const { data, error } = await supabase.from('messages').insert([{ user, text }]);
    if(error) console.error("BÅ‚Ä…d wysyÅ‚ania:", error);
  }

  // Odbieranie istniejÄ…cych wiadomoÅ›ci
  async function loadMsgs(){
    const { data, error } = await supabase.from('messages').select('*').order('created_at',{ascending:true});
    if(data){
      data.forEach(m => showMsg(m.text, m.user, m.created_at));
    }
  }

  // NasÅ‚uchiwanie na nowe wiadomoÅ›ci
  supabase.channel('chat-room')
    .on('postgres_changes', { event: 'INSERT', schema: 'public', table: 'messages' }, payload => {
      const m = payload.new;
      showMsg(m.text, m.user, m.created_at);
    })
    .subscribe();

  loadMsgs();
</script>
</body>
</html>
