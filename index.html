<!doctype html>
<html lang="pl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>ARKON CRM ‚Äî Pulpit / Indeks</title>
<meta name="description" content="Strona g≈Ç√≥wna ARKON CRM: szybkie podglƒÖdy, skr√≥ty, ostatnie rekordy, nawigacja do wszystkich modu≈Ç√≥w.">
<style>
  :root{
    --bg:#0b1020; --grad1:#0a1028; --grad2:#0d1536;
    --ink:#e8edff; --muted:#aeb8da; --line:#22306a;
    --card:#0f1636; --chip:#16245a; --accent:#4cc9f0;
    --ok:#2fbf71; --warn:#ffb84d; --bad:#ff6b6b;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{margin:0;font:15px/1.55 system-ui,Segoe UI,Roboto,Arial;background:linear-gradient(180deg,var(--grad1),var(--grad2));color:var(--ink)}
  a{color:#cfe0ff;text-decoration:none}
  header{padding:16px;border-bottom:1px solid var(--line);background:#0e1534;position:sticky;top:0;z-index:10}
  header h1{margin:0;font-size:22px}
  header .muted{color:var(--muted);font-size:13px}
  nav{display:flex;gap:10px;flex-wrap:wrap;padding:10px 16px;border-bottom:1px solid var(--line);background:#121a44}
  nav a{padding:8px 12px;border-radius:999px;border:1px solid #2a3a75}
  nav a:hover{background:#1a2758}
  .wrap{max-width:1280px;margin:0 auto;padding:16px}
  .grid{display:grid;gap:14px}
  @media(min-width:1100px){ .cols-3{grid-template-columns:repeat(3,1fr)} .cols-2{grid-template-columns:2fr 1fr} }
  .card{background:linear-gradient(180deg,#0f1636,#0f1a42);border:1px solid var(--line);border-radius:14px;padding:14px}
  .row{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
  .pill{display:inline-block;background:#0d1530;border:1px dashed #2b3a77;border-radius:999px;padding:6px 10px;color:#aeb8da;font-size:13px}
  .btn{background:#233261;border:1px solid #3a4ca3;color:#fff;border-radius:10px;padding:8px 12px;cursor:pointer}
  .btn.ghost{background:transparent;border:1px dashed #3a4ca3}
  .btn.bad{background:#3a1f2a;border-color:#7b3341}
  .btn.ok{background:#194d34;border-color:#2f9762}
  .kbd{font:12px/1.2 ui-monospace,Menlo,Consolas,monospace;background:#101735;border:1px solid #2a3777;padding:2px 6px;border-radius:6px;color:#cfe0ff}
  table{width:100%;border-collapse:separate;border-spacing:0}
  th,td{padding:8px 6px;border-bottom:1px solid #1a244d;text-align:left;vertical-align:top}
  th{font-size:12px;color:var(--muted)}
  .small{font-size:12px;color:var(--muted)}
  .right{display:flex;gap:8px;justify-content:flex-end}
  .kpi{display:flex;align-items:center;gap:12px}
  .kpi .n{font-weight:700;font-size:20px}
  .ok{color:#7ee2ab} .warn{color:#ffd699} .bad{color:#ffb1b1}
  .list-reset{list-style:none;margin:0;padding:0}
  .status{padding:2px 8px;border-radius:999px;font-size:12px;border:1px solid #2a3a75;background:#0f1a44}
  .status.lead{background:#19224e}
  .status.q{background:#21305f}
  .status.w{background:#24336b}
  .status.c{background:#1d3d2f}
  .status.l{background:#4a1d1d}
  .apps{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:12px}
  .app{display:block;padding:14px;border-radius:12px;background:#111a42;border:1px solid #2a3a75}
  .app b{display:block;margin-bottom:4px}
  .app:hover{background:#16235a}
  .tag{display:inline-block;margin:2px 6px 0 0;padding:3px 8px;border:1px solid #3a4ca3;border-radius:999px;font-size:12px}
  .grid-2{display:grid;grid-template-columns:1fr 1fr;gap:8px}
  @media(max-width:720px){ .grid-2{grid-template-columns:1fr} }
  @media print{ nav,.btn,.kbd{display:none!important} }
</style>
</head>
<body>

<header>
  <h1>Pulpit ‚Ä¢ ARKON CRM</h1>
  <div class="small">Szybki podglƒÖd i skr√≥ty. Wszystkie dane przechowywane lokalnie (LocalStorage/IndexedDB). Eksport/Backup dostƒôpny z modu≈Ç√≥w.</div>
</header>

<nav aria-label="Nawigacja g≈Ç√≥wna">
  <a href="index.html" aria-current="page">üè† Pulpit</a>
  <a href="klienci.html">üë• Klienci</a>
  <a href="lidy.html">üß≤ Lidy</a>
  <a href="komponenty.html">üß© Komponenty</a>
  <a href="upload.html">üì§ Przesy≈Ç plik√≥w</a>
  <a href="dokumenty.html">üìÑ Dokumenty</a>
  <a href="chat.html">üí¨ Komunikator</a>
  <a href="ustawienia.html">‚öôÔ∏è Ustawienia</a>
  <a href="kalkulator.html" target="_blank" rel="noopener">üßÆ Kalkulator ‚ÜóÔ∏è</a>
  <a href="baza.html">üóÉÔ∏è Baza (storage)</a>
</nav>

<div class="wrap grid cols-2">
  <!-- LEWA KOLUMNA -->
  <section class="grid">
    <!-- KPI -->
    <div class="grid cols-3">
      <div class="card">
        <div class="kpi"><div>üë•</div><div><div class="small">Klienci</div><div id="kpiClients" class="n">0</div></div></div>
      </div>
      <div class="card">
        <div class="kpi"><div>üß≤</div><div><div class="small">Lidy</div><div id="kpiLeads" class="n">0</div></div></div>
      </div>
      <div class="card">
        <div class="kpi"><div>üß©</div><div><div class="small">Komponenty</div><div id="kpiComp" class="n">0</div></div></div>
      </div>
    </div>

    <!-- Skr√≥ty / Quick actions -->
    <div class="card">
      <div class="row" style="justify-content:space-between">
        <div><b>Skr√≥ty</b></div>
        <div class="small">Tip: <span class="kbd">/</span> ‚Äî szukaj klienta ‚Ä¢ <span class="kbd">Alt+N</span> ‚Äî nowy klient</div>
      </div>
      <div class="row" style="margin-top:6px">
        <a class="btn ok" href="klienci.html">+ Nowy klient</a>
        <a class="btn" href="lidy.html">+ Nowy lead</a>
        <a class="btn ghost" href="komponenty.html">Dodaj komponent</a>
        <a class="btn ghost" href="upload.html">Wy≈õlij pliki</a>
        <a class="btn" href="kalkulator.html" target="_blank" rel="noopener">Kalkulator ‚ÜóÔ∏è</a>
      </div>
    </div>

    <!-- Ostatni klienci -->
    <div class="card">
      <div class="row" style="justify-content:space-between"><b>Ostatnio dodani klienci</b><a class="small" href="klienci.html">Zobacz wszystkich ‚Üí</a></div>
      <div style="overflow:auto;margin-top:6px">
        <table id="tblClients">
          <thead><tr><th>Nazwa</th><th>Status</th><th>Kontakt</th><th>Tagi</th><th>Dodano</th></tr></thead>
          <tbody></tbody>
        </table>
      </div>
    </div>

    <!-- Ostatnie lidy -->
    <div class="card">
      <div class="row" style="justify-content:space-between"><b>Ostatnie lidy</b><a class="small" href="lidy.html">Zobacz wszystkie ‚Üí</a></div>
      <div style="overflow:auto;margin-top:6px">
        <table id="tblLeads">
          <thead><tr><th>Tytu≈Ç</th><th>≈πr√≥d≈Ço</th><th>Status</th><th>Data</th></tr></thead>
          <tbody></tbody>
        </table>
      </div>
    </div>
  </section>

  <!-- PRAWA KOLUMNA -->
  <aside class="grid">
    <!-- Aplikacje / Modu≈Çy -->
    <div class="card">
      <b>Modu≈Çy</b>
      <div class="apps" style="margin-top:8px">
        <a class="app" href="klienci.html"><b>Klienci</b><span class="small">Lista, edycja, projekty, dokumenty, pola w≈Çasne.</span></a>
        <a class="app" href="lidy.html"><b>Lidy</b><span class="small">Zbieranie i kwalifikacja lead√≥w.</span></a>
        <a class="app" href="komponenty.html"><b>Komponenty</b><span class="small">Pompy, piece, PV, ocieplenie, bramy.</span></a>
        <a class="app" href="upload.html"><b>Przesy≈Ç plik√≥w</b><span class="small">Pliki w IndexedDB, przypisania do klienta i kategorii.</span></a>
        <a class="app" href="dokumenty.html"><b>Dokumenty</b><span class="small">Wzory um√≥w, pe≈Çnomocnictwa, o≈õwiadczenia.</span></a>
        <a class="app" href="chat.html"><b>Komunikator</b><span class="small">Lokalny czat + za≈ÇƒÖczniki.</span></a>
        <a class="app" href="ustawienia.html"><b>Ustawienia</b><span class="small">Preferencje, wydruk do PDF.</span></a>
        <a class="app" href="baza.html"><b>Baza</b><span class="small">PodglƒÖd i czyszczenie pamiƒôci lokalnej.</span></a>
        <a class="app" href="kalkulator.html" target="_blank" rel="noopener"><b>Kalkulator</b><span class="small">Symulacje i kosztorysy (otwiera nowe okno).</span></a>
      </div>
    </div>

    <!-- Statystyki komponent√≥w -->
    <div class="card">
      <b>Komponenty ‚Äî szybki podglƒÖd</b>
      <div class="grid-2 small" style="margin-top:6px">
        <div>Pompy: <b id="cmp_pumps">0</b></div>
        <div>Piece/Kot≈Çy: <b id="cmp_boilers">0</b></div>
        <div>Fotowoltaika: <b id="cmp_pv">0</b></div>
        <div>Ocieplenie: <b id="cmp_insul">0</b></div>
        <div>Bramy: <b id="cmp_garage">0</b></div>
      </div>
      <div class="right" style="margin-top:8px">
        <a class="btn ghost" href="komponenty.html">Otw√≥rz komponenty</a>
      </div>
    </div>

    <!-- Notatki / log -->
    <div class="card">
      <b>Szybka notatka</b>
      <textarea id="note" placeholder="Twoja notatka (zapisuje siƒô lokalnie)" style="width:100%;min-height:100px;margin-top:8px"></textarea>
      <div class="right" style="margin-top:8px">
        <button id="btnClearNote" class="btn ghost">Wyczy≈õƒá</button>
      </div>
      <div class="small" style="margin-top:6px">Przechowywane w <code>localStorage</code> (klucz: <code>arkon_note</code>).</div>
    </div>
  </aside>
</div>

<script>
'use strict';

/* ===== helpers ===== */
const $  = s => document.querySelector(s);
const $$ = s => Array.from(document.querySelectorAll(s));
const INT = new Intl.NumberFormat('pl-PL',{maximumFractionDigits:0});
const fmt = n => INT.format(Math.round(Number(n)||0));
const fmtDate = ts => new Date(ts||Date.now()).toLocaleString('pl-PL');

/* ===== storage keys (zgodnie z innymi stronami) ===== */
const LS = {
  clients: 'arkon_clients_v1',
  leads:   'arkon_leads_v1',
  cmp: {
    pumps:  'arkon_cmp_pumps_v1',
    boilers:'arkon_cmp_boilers_v1',
    pv:     'arkon_cmp_pv_v1',
    insul:  'arkon_cmp_insul_v1',
    garage: 'arkon_cmp_garage_v1'
  },
  note: 'arkon_note'
};

/* ===== load helpers ===== */
function load(key, fallback){
  try{ return JSON.parse(localStorage.getItem(key) || JSON.stringify(fallback)); }catch{ return fallback; }
}

/* ===== KPI ===== */
function refreshKPI(){
  const clients = load(LS.clients, []);
  const leads   = load(LS.leads,   []);
  const cmpSum =
    ['pumps','boilers','pv','insul','garage']
      .map(k => load(LS.cmp[k], []).length)
      .reduce((a,b)=>a+b,0);
  $('#kpiClients').textContent = clients.length;
  $('#kpiLeads').textContent   = leads.length;
  $('#kpiComp').textContent    = cmpSum;

  // komponenty by cat
  $('#cmp_pumps').textContent  = load(LS.cmp.pumps, []).length;
  $('#cmp_boilers').textContent= load(LS.cmp.boilers, []).length;
  $('#cmp_pv').textContent     = load(LS.cmp.pv, []).length;
  $('#cmp_insul').textContent  = load(LS.cmp.insul, []).length;
  $('#cmp_garage').textContent = load(LS.cmp.garage, []).length;
}

/* ===== Recent Clients ===== */
function renderRecentClients(){
  const tb = $('#tblClients tbody'); tb.innerHTML = '';
  const clients = load(LS.clients, [])
    .slice().sort((a,b)=>(b.created||0)-(a.created||0)).slice(0,8);
  if(!clients.length){
    tb.innerHTML = '<tr><td colspan="5" class="small">Brak danych. Dodaj pierwszego klienta w module ‚ÄûKlienci‚Äù.</td></tr>';
    return;
  }
  clients.forEach(c=>{
    const tr = document.createElement('tr');
    const tags = (c.tags||[]).slice(0,3).map(t=>'<span class="tag">'+escapeHtml(t)+'</span>').join('');
    tr.innerHTML = \`
      <td><a href="klienci.html" title="Otw√≥rz w Klienci"><b>\${escapeHtml(c.name||'‚Äî')}</b></a></td>
      <td><span class="status \${statusClass(c.status)}">\${escapeHtml(c.status||'‚Äî')}</span></td>
      <td>\${escapeHtml(c.email||'')}<div class="small">\${escapeHtml(c.phone||'')}</div></td>
      <td>\${tags}</td>
      <td>\${fmtDate(c.created)}</td>\`;
    tb.appendChild(tr);
  });
}

/* ===== Recent Leads ===== */
function renderRecentLeads(){
  const tb = $('#tblLeads tbody'); tb.innerHTML = '';
  const leads = load(LS.leads, [])
    .slice().sort((a,b)=>(b.created||0)-(a.created||0)).slice(0,8);
  if(!leads.length){
    tb.innerHTML = '<tr><td colspan="4" class="small">Brak lead√≥w. Dodaj w module ‚ÄûLidy‚Äù.</td></tr>';
    return;
  }
  leads.forEach(l=>{
    const tr = document.createElement('tr');
    tr.innerHTML = \`
      <td><a href="lidy.html"><b>\${escapeHtml(l.title||'Lead')}</b></a></td>
      <td>\${escapeHtml(l.source||'')}</td>
      <td>\${escapeHtml(l.status||'NOWY')}</td>
      <td>\${fmtDate(l.created)}</td>\`;
    tb.appendChild(tr);
  });
}

/* ===== Notatka ===== */
function initNote(){
  const el = $('#note');
  el.value = localStorage.getItem(LS.note) || '';
  el.addEventListener('input', ()=> localStorage.setItem(LS.note, el.value));
  $('#btnClearNote').addEventListener('click', ()=>{
    if(confirm('Wyczy≈õciƒá notatkƒô?')){ el.value=''; localStorage.removeItem(LS.note); }
  });
}

/* ===== utils ===== */
function escapeHtml(s){ return (s==null?'':String(s)).replace(/[&<>"]/g, c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;'}[c])); }
function statusClass(s){
  switch((s||'').toUpperCase()){
    case 'LEAD': return 'lead';
    case 'ZAPYTANIE': return 'q';
    case 'W TOKU': return 'w';
    case 'KLIENT': return 'c';
    case 'UTRACONY': return 'l';
    default: return '';
  }
}

/* ===== keyboard shortcuts ===== */
window.addEventListener('keydown', (e)=>{
  // / -> przej≈õcie do Klienci z fokusem na wyszukiwarce (o ile istnieje)
  if(e.key === '/'){
    e.preventDefault();
    location.href = 'klienci.html';
  }
  // Alt+N -> Nowy klient (przekierowanie do klienci.html gdzie dzia≈Ça przycisk)
  if(e.altKey && (e.key==='n' || e.key==='N')){
    e.preventDefault();
    location.href = 'klienci.html#new';
  }
});

/* ===== boot ===== */
refreshKPI();
renderRecentClients();
renderRecentLeads();
initNote();
</script>
</body>
</html>
