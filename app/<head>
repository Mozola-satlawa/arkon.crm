<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <title>ARKON CRM</title>
  <!-- Supabase SDK -->
  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
  <!-- Chart.js (dashboard wykresy) -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <!-- jsPDF (generowanie PDF umów) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    body{margin:0;font-family:system-ui,Arial,sans-serif;background:#0b1020;color:#e7ecff}
    .nav{display:flex;gap:12px;padding:12px;background:#111;border-bottom:1px solid #333}
    .tab{cursor:pointer;padding:6px 10px;border-radius:6px}
    .tab.active{background:#1a244d}
    .container{max-width:1200px;margin:0 auto;padding:16px}
    .card{background:#0f1636;border:1px solid #263168;border-radius:12px;padding:16px;margin-bottom:16px}
  </style>
</head>
<body>
  <div class="nav">
    <div class="brand">ARKON CRM</div>
    <div class="tab active" data-tab="dashboard">Pulpit</div>
    <div class="tab" data-tab="chat">Komunikator</div>
    <div class="tab" data-tab="login">Logowanie</div>
  </div>

  <div class="container">
    <section id="tab-dashboard">
      <h1>Pulpit</h1>
      <div class="card">Tutaj pojawią się dane (przychody, umowy, prowizje).</div>
    </section>

    <section id="tab-chat" hidden>
      <h1>Komunikator</h1>
      <div id="chat-box" class="card" style="height:200px;overflow:auto"></div>
      <input id="chat-text" placeholder="Napisz wiadomość…" style="width:80%">
      <button id="chat-send">Wyślij</button>
    </section>

    <section id="tab-login" hidden>
      <h1>Logowanie</h1>
      <button id="login-google">Zaloguj przez Google</button>
      <button id="login-facebook">Zaloguj przez Facebook</button>
      <button id="logout">Wyloguj</button>
      <div id="user-info" class="card"></div>
    </section>
  </div>

<script>
  // ===== KONFIGURACJA SUPABASE =====
  const SUPABASE_URL = "https://TWÓJ_PROJEKT.supabase.co";   // <- zmień na swój
  const SUPABASE_ANON_KEY = "TWÓJ_PUBLIC_ANON_KEY";         // <- zmień na swój
  const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

  // ===== NAWIGACJA =====
  document.querySelectorAll(".tab").forEach(tab=>{
    tab.addEventListener("click", ()=>{
      document.querySelectorAll(".tab").forEach(t=>t.classList.remove("active"));
      tab.classList.add("active");
      const key = tab.dataset.tab;
      document.querySelectorAll("section").forEach(s=>s.hidden=true);
      document.querySelector("#tab-"+key).hidden=false;
    });
  });

  // ===== LOGOWANIE =====
  const infoBox = document.getElementById("user-info");
  async function refreshUser(){
    const { data: { user } } = await supabase.auth.getUser();
    infoBox.textContent = user ? Zalogowany: ${user.email} : "Brak aktywnej sesji";
  }
  document.getElementById("login-google").onclick = ()=>supabase.auth.signInWithOAuth({ provider:"google" });
  document.getElementById("login-facebook").onclick = ()=>supabase.auth.signInWithOAuth({ provider:"facebook" });
  document.getElementById("logout").onclick = async ()=>{ await supabase.auth.signOut(); refreshUser(); };
  refreshUser();

  // ===== CHAT REALTIME =====
  const chatBox = document.getElementById("chat-box");
  const chatText = document.getElementById("chat-text");
  document.getElementById("chat-send").onclick = async ()=>{
    const text = chatText.value.trim(); if(!text) return;
    const { data: { user } } = await supabase.auth.getUser();
    await supabase.from("messages").insert({ content:text, user_id:user.id });
    chatText.value="";
  };
  // odbieranie wiadomości
  supabase.channel('chat-room')
    .on('postgres_changes', { event:'INSERT', schema:'public', table:'messages' }, payload=>{
      const msg = payload.new;
      const div=document.createElement("div");
      div.textContent = msg.content;
      chatBox.appendChild(div);
      chatBox.scrollTop=chatBox.scrollHeight;
    })
    .subscribe();
</script>
</body>
</html>
